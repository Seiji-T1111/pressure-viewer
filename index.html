<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>体調記録アプリ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    form { margin-bottom: 20px; }
    label { margin-right: 10px; }
    select, input { margin-right: 20px; }
    canvas { max-width: 600px; }
  </style>
</head>
<body>
  <h2>体調記録アプリ</h2>
  <form id="healthForm">
    <label for="date">日付:</label>
    <input type="date" id="date" name="date" required>
    
    <label for="condition">体調スコア:</label>
    <select id="condition" name="condition" required>
      <option value="" disabled selected>選択してください</option>
      <option value="ふつう">ふつう</option>
      <option value="良い">良い</option>
      <option value="とても良い">とても良い</option>
    </select>
    
    <button type="submit">追加</button>
  </form>

  <canvas id="healthChart"></canvas>

  <script>
    const form = document.getElementById('healthForm');
    const ctx = document.getElementById('healthChart').getContext('2d');

    const conditionMap = {
      "ふつう": 1,
      "良い": 2,
      "とても良い": 3
    };

    const conditionLabels = {
      1: "ふつう",
      2: "良い",
      3: "とても良い"
    };

    const healthData = JSON.parse(localStorage.getItem('healthData')) || [];

    // 日付を曜日付きでフォーマットする関数
    function formatDateWithDay(dateStr) {
      const date = new Date(dateStr);
      const days = ["日", "月", "火", "水", "木", "金", "土"];
      return `${date.getMonth() + 1}/${date.getDate()} (${days[date.getDay()]})`;
    }

    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: healthData.map(entry => formatDateWithDay(entry.date)),
        datasets: [{
          label: '体調スコア',
          data: healthData.map(entry => entry.condition),
          borderColor: 'blue',
          fill: false,
          tension: 0.1
        }]
      },
      options: {
        scales: {
          y: {
            ticks: {
              stepSize: 1,
              callback: function(value) {
                return conditionLabels[value] || value;
              }
            },
            min: 1,
            max: 3
          }
        }
      }
    });

    form.addEventListener('submit', function(event) {
      event.preventDefault();

      const date = document.getElementById('date').value;
      const conditionText = document.getElementById('condition').value;

      if (!date || !conditionText) return;

      const conditionValue = conditionMap[conditionText];

      // 同じ日付があれば上書き
      const existingIndex = healthData.findIndex(entry => entry.date === date);
      if (existingIndex >= 0) {
        healthData[existingIndex].condition = conditionValue;
      } else {
        healthData.push({ date, condition: conditionValue });
      }

      localStorage.setItem('healthData', JSON.stringify(healthData));

      chart.data.labels = healthData.map(entry => formatDateWithDay(entry.date));
      chart.data.datasets[0].data = healthData.map(entry => entry.condition);
      chart.update();

      form.reset();
    });
  </script>
</body>
</html>
