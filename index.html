<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>気圧＆体調ビューア</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
    font-family: sans-serif;
    margin: 0;
    padding: 0;
    text-align: center;
}
#chartContainer {
    width: 95%;
    max-width: 900px;
    margin: 20px auto;
}
canvas {
    background-color: #fff;
    border: 1px solid #ccc;
}
</style>
</head>
<body>

<h1>気圧＆体調ビューア</h1>
<div id="chartContainer">
    <canvas id="myChart"></canvas>
</div>

<script>
// ======== 仮データ生成 =========
const today = new Date();
const dates = [];
const pressures = [];
const weathers = [];
for (let i = 0; i < 14; i++) {
    const d = new Date(today);
    d.setDate(d.getDate() - (13 - i));
    const dateStr = `${d.getMonth() + 1}/${d.getDate()}`;
    dates.push(dateStr);
    pressures.push(1000 + Math.random() * 30); // 気圧
    weathers.push(Math.floor(Math.random() * 3)); // 0:晴れ 1:曇り 2:雨
}

// 体調データ（サンプル）null → 0 に修正
const symptomData = {};
dates.forEach((d, i) => {
    symptomData[d] = Math.random() > 0.3 ? Math.floor(Math.random() * 5) : 0;
});

// ======== Chart.js 描画 =========
const ctx = document.getElementById('myChart').getContext('2d');

const chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: dates,
        datasets: [
            {
                label: '気圧(hPa)',
                data: pressures,
                borderColor: 'blue',
                backgroundColor: 'rgba(0,0,255,0.1)',
                yAxisID: 'y',
                pointBackgroundColor: pressures.map(p => {
                    if (p >= 1020) return 'orange';
                    if (p <= 1005) return 'red';
                    return 'blue';
                }),
                tension: 0.3
            },
            {
                label: '体調(0〜5)',
                data: dates.map(d => symptomData[d]),
                borderColor: 'green',
                backgroundColor: 'rgba(0,255,0,0.2)',
                yAxisID: 'y1',
                spanGaps: true
            }
        ]
    },
    options: {
        responsive: true,
        interaction: { mode: 'index', intersect: false },
        stacked: false,
        plugins: {
            legend: { position: 'top' },
            title: { display: true, text: '気圧と体調の推移' }
        },
        scales: {
            y: {
                type: 'linear',
                position: 'left',
                min: 980,
                max: 1040
            },
            y1: {
                type: 'linear',
                position: 'right',
                min: 0,
                max: 5,
                grid: { drawOnChartArea: false }
            }
        }
    },
    plugins: [{
        id: 'weatherBackground',
        beforeDraw: (chart) => {
            const { ctx, chartArea: { top, bottom, left, right }, scales: { x } } = chart;
            ctx.save();
            const colors = {
                0: 'rgba(255, 255, 0, 0.3)',  // 晴れ
                1: 'rgba(200, 200, 200, 0.3)', // 曇り
                2: 'rgba(100, 100, 255, 0.3)'  // 雨
            };
            dates.forEach((label, i) => {
                ctx.fillStyle = colors[weathers[i]];
                ctx.fillRect(
                    x.getPixelForTick(i) - (x.getPixelForTick(i+1) - x.getPixelForTick(i))/2,
                    top,
                    (x.getPixelForTick(i+1) - x.getPixelForTick(i)),
                    bottom - top
                );
            });
            ctx.restore();
        }
    }]
});
</script>

</body>
</html>
