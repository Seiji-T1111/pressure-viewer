<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>気圧と体調記録</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: sans-serif; }
  .container { max-width: 900px; margin: auto; }
  canvas { background: #fdfdfd; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
  .toggle-btn { margin: 10px 0; padding: 6px 10px; }
</style>
</head>
<body>
<div class="container">
  <h2>気圧と体調の記録</h2>
  <button class="toggle-btn" onclick="toggleView()">グラフ / 表 切り替え</button>
  <div id="chartContainer">
    <canvas id="pressureChart"></canvas>
  </div>
  <div id="tableContainer" style="display:none; overflow-x: scroll; max-height: 400px;">
    <table>
      <thead>
        <tr><th>日付</th><th>気圧(hPa)</th><th>気圧変化</th><th>体調メモ</th></tr>
      </thead>
      <tbody id="dataBody"></tbody>
    </table>
  </div>
</div>

<script>
// ダミーデータ生成（1か月分）
const dates = [];
const pressures = [];
const memos = {};
let currentPressure = 1010;

for (let i = 0; i < 30; i++) {
  const date = new Date();
  date.setDate(date.getDate() - (29 - i));
  const label = `${date.getMonth()+1}/${date.getDate()}`;
  dates.push(label);
  // 気圧はランダムで変化
  currentPressure += (Math.random() - 0.5) * 6;
  pressures.push(Math.round(currentPressure * 10) / 10);

  // 体調メモ（サンプル）
  if (i % 5 === 0) memos[label] = "頭痛";
  if (i % 7 === 0) memos[label] = "だるい";
  if (i % 9 === 0) memos[label] = "元気";
}

// 気圧変化（前日比）
function getPressureChange(i) {
  if (i === 0) return "-";
  const diff = pressures[i] - pressures[i-1];
  return (diff > 0 ? "+" : "") + diff.toFixed(1);
}

// 表データ出力
const tbody = document.getElementById("dataBody");
dates.forEach((d, i) => {
  const tr = document.createElement("tr");
  tr.innerHTML = `<td>${d}</td><td>${pressures[i]}</td><td>${getPressureChange(i)}</td><td>${memos[d] || ""}</td>`;
  tbody.appendChild(tr);
});

// Chart.js 設定
const ctx = document.getElementById('pressureChart').getContext('2d');
const chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: dates,
    datasets: [{
      label: '気圧(hPa)',
      data: pressures,
      borderColor: 'blue',
      fill: false,
      tension: 0.3,
      pointBackgroundColor: dates.map(d => memos[d] ? 'red' : 'blue'),
      pointRadius: dates.map(d => memos[d] ? 6 : 3),
    }]
  },
  options: {
    responsive: true,
    plugins: {
      tooltip: {
        callbacks: {
          afterLabel: function(context) {
            const date = context.label;
            return memos[date] ? `体調: ${memos[date]}` : '';
          }
        }
      }
    },
    scales: {
      y: {
        suggestedMin: 990,
        suggestedMax: 1030
      }
    }
  }
});

function toggleView() {
  const chartDiv = document.getElementById('chartContainer');
  const tableDiv = document.getElementById('tableContainer');
  if (chartDiv.style.display === 'none') {
    chartDiv.style.display = '';
    tableDiv.style.display = 'none';
  } else {
    chartDiv.style.display = 'none';
    tableDiv.style.display = '';
  }
}
</script>
</body>
</html>
