<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>気圧と体調グラフ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: sans-serif; margin: 20px; background: #f8f9fa; }
  h1 { font-size: 1.5em; margin-bottom: 12px; }
  #toggleBtn { margin-bottom: 16px; padding: 8px 12px; cursor: pointer; }
  #chartContainer, #tableContainer {
    background: white;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    padding: 20px;
    max-width: 800px;
    margin-bottom: 24px;
  }
  #tableContainer { display: none; max-height: 400px; overflow-y: auto; }
  table {
    width: 100%; border-collapse: collapse; 
  }
  th, td {
    border: 1px solid #ddd; padding: 8px; text-align: center;
  }
  th { background: #f3f3f3; }
  tr.today { background: #fff7cc; font-weight: 700; }
</style>
</head>
<body>

<h1>気圧と体調の推移（5段階評価）</h1>
<button id="toggleBtn">表に切り替え</button>

<div id="chartContainer">
  <canvas id="pressureChart" width="760" height="400"></canvas>
</div>

<div id="tableContainer">
  <table>
    <thead>
      <tr><th>日付</th><th>気圧 (hPa)</th><th>体調スコア (1〜5)</th></tr>
    </thead>
    <tbody id="dataBody"></tbody>
  </table>
</div>

<script>
  const data = [
    { date: '2024-07-01', pressure: 1005, symptom: 1 },
    { date: '2024-07-05', pressure: 1008, symptom: 1 },
    { date: '2024-07-10', pressure: 1003, symptom: 1 },
    { date: '2024-07-15', pressure: 1006, symptom: 1 },
    { date: '2024-07-20', pressure: 1009, symptom: 2 },
    { date: '2024-07-25', pressure: 1012, symptom: 3 },
    { date: '2024-08-01', pressure: 1015, symptom: 4 },
    { date: '2024-08-05', pressure: 1014, symptom: 4 },
    { date: '2024-08-10', pressure: 1010, symptom: 3 },
    { date: '2024-08-12', pressure: 1006, symptom: 2 }
  ];

  const todayStr = new Date().toISOString().split('T')[0];

  // 表の生成
  const tbody = document.getElementById('dataBody');
  data.forEach(({date, pressure, symptom}) => {
    const tr = document.createElement('tr');
    if(date === todayStr) tr.classList.add('today');
    tr.innerHTML = `<td>${date}</td><td>${pressure}</td><td>${symptom}</td>`;
    tbody.appendChild(tr);
  });

  // Chart.js 設定
  const ctx = document.getElementById('pressureChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: data.map(d => d.date),
      datasets: [
        {
          label: '気圧 (hPa)',
          data: data.map(d => d.pressure),
          yAxisID: 'yRight',
          borderColor: 'rgba(54, 162, 235, 1)',
          backgroundColor: 'rgba(54, 162, 235, 0.15)',
          fill: true,
          tension: 0.3,
          pointRadius: 4,
          order: 2,
        },
        {
          label: '体調スコア (1〜5)',
          data: data.map(d => d.symptom),
          yAxisID: 'yLeft',
          borderColor: 'rgba(255, 99, 132, 1)',
          backgroundColor: 'rgba(255, 99, 132, 0.15)',
          fill: true,
          tension: 0.3,
          pointRadius: 4,
          order: 1,
        }
      ]
    },
    options: {
      responsive: true,
      interaction: { mode: 'index', intersect: false },
      stacked: false,
      scales: {
        yLeft: {
          type: 'linear',
          position: 'left',
          min: 0,
          max: 5,
          ticks: { stepSize: 1 },
          title: { display: true, text: '体調スコア' },
        },
        yRight: {
          type: 'linear',
          position: 'right',
          min: 990,
          max: 1030,
          grid: { drawOnChartArea: false },
          title: { display: true, text: '気圧 (hPa)' },
        },
        x: {
          title: { display: true, text: '日付' }
        }
      },
      plugins: {
        legend: { position: 'top' },
        tooltip: {
          enabled: true,
          mode: 'nearest',
          intersect: false,
          callbacks: {
            label: ctx => ctx.dataset.label + ': ' + ctx.formattedValue
          }
        }
      }
    }
  });

  // 表・グラフ切り替え
  const toggleBtn = document.getElementById('toggleBtn');
  const chartDiv = document.getElementById('chartContainer');
  const tableDiv = document.getElementById('tableContainer');

  toggleBtn.addEventListener('click', () => {
    if(chartDiv.style.display === 'none'){
      chartDiv.style.display = 'block';
      tableDiv.style.display = 'none';
      toggleBtn.textContent = '表に切り替え';
    } else {
      chartDiv.style.display = 'none';
      tableDiv.style.display = 'block';
      toggleBtn.textContent = 'グラフに切り替え';
    }
  });
</script>

</body>
</html>
