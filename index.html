<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>体調ビューアー</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  #controls { margin-bottom: 10px; }
  canvas { max-width: 100%; }
</style>
</head>
<body>

<h1>体調ビューアー</h1>

<div id="controls">
  <label for="periodSelect">表示期間:</label>
  <select id="periodSelect">
    <option value="7">7日間</option>
    <option value="14" selected>14日間</option>
    <option value="30">30日間</option>
    <option value="90">3ヶ月</option>
  </select>
</div>

<canvas id="moodChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const chartCanvas = document.getElementById('moodChart').getContext('2d');
let moodData = JSON.parse(localStorage.getItem('moodData') || '[]');

function renderChart(periodDays) {
  const now = new Date();
  const filteredData = moodData.filter(item => {
    const itemDate = new Date(item.date);
    const diffDays = (now - itemDate)/(1000*60*60*24);
    return diffDays <= periodDays;
  }).sort((a,b)=> new Date(a.date)-new Date(b.date));

  const labels = filteredData.map(d => d.date);
  const values = filteredData.map(d => d.mood);

  if(window.moodChartInstance) {
    window.moodChartInstance.destroy();
  }

  window.moodChartInstance = new Chart(chartCanvas, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: '体調',
        data: values,
        borderColor: 'blue',
        backgroundColor: 'rgba(0,0,255,0.2)',
        fill: true,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          min: 1,
          max: 5,
          ticks: { stepSize: 1 }
        },
        x: {
          ticks: { autoSkip: true, maxTicksLimit: 10 }
        }
      }
    }
  });
}

document.getElementById('periodSelect').addEventListener('change', (e)=>{
  const days = parseInt(e.target.value);
  renderChart(days);
});

// 初期表示
renderChart(parseInt(document.getElementById('periodSelect').value));
</script>

</body>
</html>
