<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>過去30日間の気圧データ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }
  .hidden {
    display: none;
  }
  .table-container {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #ccc;
  }
  table {
    border-collapse: collapse;
    width: 100%;
  }
  th, td {
    padding: 6px 8px;
    border: 1px solid #ccc;
    text-align: center;
  }
  .today {
    background-color: #e0e0e0;
    font-weight: bold;
  }
  .up {
    color: green;
  }
  .down {
    color: red;
  }
</style>
</head>
<body>

<h1>過去30日間の気圧データ</h1>
<button id="toggleView">表に切り替え</button>

<div id="chartContainer">
  <canvas id="pressureChart" width="800" height="400"></canvas>
</div>

<div id="tableContainer" class="hidden">
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>日付</th>
          <th>気圧(hPa)</th>
          <th>変化</th>
        </tr>
      </thead>
      <tbody id="pressureTableBody"></tbody>
    </table>
  </div>
</div>

<script>
  // ▼ ダミーデータ生成（本来はAPIから取得する）
  const today = new Date();
  const labels = [];
  const data = [];
  for (let i = 29; i >= 0; i--) {
    const date = new Date();
    date.setDate(today.getDate() - i);
    const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;
    labels.push(dateStr);
    // 1000〜1025あたりのランダム気圧
    data.push(Math.round(1000 + Math.random() * 25));
  }

  // ▼ Chart.js グラフ設定
  const ctx = document.getElementById('pressureChart').getContext('2d');
  const todayIndex = labels.length - 1;
  const pressureChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: '気圧 (hPa)',
        data: data,
        borderColor: 'blue',
        fill: false,
        tension: 0.1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: true }
      },
      scales: {
        x: {
          ticks: {
            color: ctx => ctx.index === todayIndex ? 'black' : 'gray',
            font: ctx => ctx.index === todayIndex ? { weight: 'bold' } : {}
          }
        }
      }
    },
    plugins: [{
      id: 'highlightToday',
      beforeDraw: (chart) => {
        const chartArea = chart.chartArea;
        const xAxis = chart.scales.x;
        const index = todayIndex;
        const left = xAxis.getPixelForValue(index - 0.5);
        const right = xAxis.getPixelForValue(index + 0.5);
        const ctx = chart.ctx;
        ctx.save();
        ctx.fillStyle = '#e0e0e0';
        ctx.fillRect(left, chartArea.top, right - left, chartArea.bottom - chartArea.top);
        ctx.restore();
      }
    }]
  });

  // ▼ 表の生成
  const tbody = document.getElementById('pressureTableBody');
  for (let i = 0; i < labels.length; i++) {
    const row = document.createElement('tr');
    if (i === todayIndex) row.classList.add('today');

    const dateCell = document.createElement('td');
    dateCell.textContent = labels[i];
    row.appendChild(dateCell);

    const pressureCell = document.createElement('td');
    pressureCell.textContent = data[i];
    row.appendChild(pressureCell);

    const changeCell = document.createElement('td');
    if (i > 0) {
      const diff = data[i] - data[i - 1];
      if (diff > 0) {
        changeCell.textContent = `↑ ${diff}`;
        changeCell.classList.add('up');
      } else if (diff < 0) {
        changeCell.textContent = `↓ ${Math.abs(diff)}`;
        changeCell.classList.add('down');
      } else {
        changeCell.textContent = '-';
      }
    } else {
      changeCell.textContent = '-';
    }
    row.appendChild(changeCell);

    tbody.appendChild(row);
  }

  // ▼ 切り替えボタン
  document.getElementById('toggleView').addEventListener('click', () => {
    const chartContainer = document.getElementById('chartContainer');
    const tableContainer = document.getElementById('tableContainer');
    const btn = document.getElementById('toggleView');

    if (chartContainer.classList.contains('hidden')) {
      chartContainer.classList.remove('hidden');
      tableContainer.classList.add('hidden');
      btn.textContent = '表に切り替え';
    } else {
      chartContainer.classList.add('hidden');
      tableContainer.classList.remove('hidden');
      btn.textContent = 'グラフに切り替え';
    }
  });
</script>

</body>
</html>
