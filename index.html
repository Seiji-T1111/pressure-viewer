<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>過去14日間の気圧</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: sans-serif;
            max-width: 800px;
            margin: 20px auto;
        }
        canvas {
            background: #fff;
        }
    </style>
</head>
<body>
    <h1>過去14日間の気圧（東京）</h1>
    <canvas id="pressureChart" width="800" height="400"></canvas>
    <script>
        // 今日の日付を YYYY-MM-DD 形式で取得
        const todayStr = new Date().toISOString().split('T')[0];

        // 過去14日分の日付配列
        const dates = [];
        for (let i = 13; i >= 0; i--) {
            const d = new Date();
            d.setDate(d.getDate() - i);
            dates.push(d.toISOString().split('T')[0]);
        }

        // ダミー気圧データ（本番はAPIなどから取得可能）
        const pressures = dates.map(() => (Math.random() * 10 + 1005).toFixed(1));

        // Chart.js プラグインで今日の背景だけ塗る
        const highlightToday = {
            id: 'highlightToday',
            beforeDraw(chart) {
                const { ctx, chartArea: { left, right, top, bottom }, scales: { x } } = chart;
                const todayIndex = dates.indexOf(todayStr);
                if (todayIndex !== -1) {
                    const barWidth = (right - left) / dates.length;
                    const xPos = left + barWidth * todayIndex;
                    ctx.save();
                    ctx.fillStyle = 'rgba(200, 200, 200, 0.3)';
                    ctx.fillRect(xPos, top, barWidth, bottom - top);
                    ctx.restore();
                }
            }
        };

        new Chart(document.getElementById('pressureChart'), {
            type: 'line',
            data: {
                labels: dates.map(date => date === todayStr ? `**${date}**` : date),
                datasets: [{
                    label: '気圧(hPa)',
                    data: pressures,
                    borderColor: 'blue',
                    fill: false,
                    tension: 0.2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                }
            },
            plugins: [highlightToday]
        });
    </script>
</body>
</html>
