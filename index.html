<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>過去14日間の気圧</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        table { border-collapse: collapse; width: 100%; max-width: 500px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background-color: #f0f0f0; }
        .today { background-color: yellow; font-weight: bold; }
    </style>
</head>
<body>
    <h1>過去14日間の気圧</h1>
    <table id="pressure-table">
        <thead>
            <tr><th>日付</th><th>平均気圧 (hPa)</th></tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        async function fetchPressure() {
            const now = new Date();
            const endDate = now.toISOString().split('T')[0];
            const startDate = new Date(now);
            startDate.setDate(startDate.getDate() - 13); // 14日分
            const startStr = startDate.toISOString().split('T')[0];

            const url = `https://archive-api.open-meteo.com/v1/archive?latitude=35.6895&longitude=139.6917&start_date=${startStr}&end_date=${endDate}&hourly=surface_pressure&timezone=Asia%2FTokyo`;

            const res = await fetch(url);
            const data = await res.json();

            const tableBody = document.querySelector("#pressure-table tbody");

            let dailyData = {};

            // 日ごとの平均気圧を計算
            data.hourly.time.forEach((timeStr, i) => {
                const date = timeStr.split('T')[0];
                if (!dailyData[date]) dailyData[date] = [];
                dailyData[date].push(data.hourly.surface_pressure[i]);
            });

            Object.keys(dailyData).forEach(date => {
                const avg = (dailyData[date].reduce((a, b) => a + b, 0) / dailyData[date].length).toFixed(1);
                const tr = document.createElement("tr");
                if (date === endDate) {
                    tr.classList.add("today");
                }
                tr.innerHTML = `<td>${date}</td><td>${avg}</td>`;
                tableBody.appendChild(tr);
            });
        }

        fetchPressure();
    </script>
</body>
</html>
