<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>体調記録アプリ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f9f9f9;
    }
    h1 {
      text-align: center;
    }
    form {
      margin-bottom: 20px;
      padding: 15px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin: 10px 0 5px;
    }
    select, input[type="date"], button {
      padding: 8px;
      margin-bottom: 10px;
      width: 100%;
      max-width: 300px;
    }
    canvas {
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <h1>体調記録アプリ</h1>
  <form id="healthForm">
    <label for="date">日付:</label>
    <input type="date" id="date" required>

    <label for="condition">体調スコア:</label>
    <select id="condition" required>
      <option value="" disabled selected>体調を選ぶ</option>
      <option value="ふつう">ふつう</option>
      <option value="良い">良い</option>
      <option value="とても良い">とても良い</option>
    </select>

    <button type="submit">記録する</button>
  </form>

  <canvas id="healthChart" width="400" height="200"></canvas>

  <script>
    const form = document.getElementById('healthForm');
    const ctx = document.getElementById('healthChart').getContext('2d');

    const conditionMap = { "ふつう": 1, "良い": 2, "とても良い": 3 };

    let healthData = JSON.parse(localStorage.getItem("healthData")) || [];

    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: healthData.map(d => d.date),
        datasets: [{
          label: '体調スコア',
          data: healthData.map(d => conditionMap[d.condition]),
          borderColor: 'blue',
          backgroundColor: 'lightblue',
          fill: false,
          tension: 0.2
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            ticks: {
              callback: function(value) {
                return Object.keys(conditionMap).find(key => conditionMap[key] === value);
              }
            },
            beginAtZero: true,
            stepSize: 1,
            min: 0,
            max: 3
          }
        }
      }
    });

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const date = document.getElementById('date').value;
      const condition = document.getElementById('condition').value;

      if (!date || !condition) return;

      // 同じ日付のデータがある場合は更新
      const existingIndex = healthData.findIndex(d => d.date === date);
      if (existingIndex >= 0) {
        healthData[existingIndex].condition = condition;
      } else {
        healthData.push({ date, condition });
      }

      localStorage.setItem("healthData", JSON.stringify(healthData));

      chart.data.labels = healthData.map(d => d.date);
      chart.data.datasets[0].data = healthData.map(d => conditionMap[d.condition]);
